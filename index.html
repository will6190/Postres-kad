import React, { useState } from 'react';
import DessertHeader from './components/DessertHeader';
import DessertCard from './components/DessertCard';
import DessertFilter from './components/DessertFilter';
import WelcomeScreen from './components/WelcomeScreen';
import CartScreen from './components/CartScreen';
import PaymentScreen from './components/PaymentScreen';
import ServiceScreen from './components/ServiceScreen';
import LocationScreen from './components/LocationScreen';
import MissionScreen from './components/MissionScreen';
import VisionScreen from './components/VisionScreen';
import CreditsScreen from './components/CreditsScreen';
import BackButton from './components/BackButton';
import desserts from './mock/desserts';

const App = () => {
  const [currentView, setCurrentView] = useState('welcome');
  const [filteredDesserts, setFilteredDesserts] = useState(desserts);
  const [cartItems, setCartItems] = useState([]);
  const [paymentTotal, setPaymentTotal] = useState(0);
  
  const categories = [...new Set(desserts.map(dessert => dessert.category))];

  const handleFilterChange = (category) => {
    if (category === 'todos') {
      setFilteredDesserts(desserts);
    } else {
      setFilteredDesserts(desserts.filter(dessert => dessert.category === category));
    }
  };

  const handleBack = () => {
    if (currentView === 'payment') {
      setCurrentView('cart');
    } else if (currentView === 'cart') {
      setCurrentView('menu');
    } else {
      setCurrentView('welcome');
    }
  };

  const handleAddToCart = (item) => {
    setCartItems(prev => [...prev, item]);
    setCurrentView('cart');
  };

  const handleProceedToPayment = (total) => {
    setPaymentTotal(total);
    setCurrentView('payment');
  };

  const handlePaymentSuccess = () => {
    alert('Â¡Pago exitoso! Gracias por tu compra.');
    setCartItems([]);
    setCurrentView('welcome');
  };

  const renderView = () => {
    switch(currentView) {
      case 'menu':
        return (
          <div className="min-h-screen bg-gray-50">
            <DessertHeader />
            <main className="container mx-auto px-4 py-8">
              <div className="mb-6">
                <BackButton onClick={handleBack} />
                <DessertFilter 
                  categories={categories} 
                  onFilterChange={handleFilterChange} 
                />
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {filteredDesserts.map(dessert => (
                  <DessertCard 
                    key={dessert.id} 
                    dessert={dessert} 
                    onAddToCart={handleAddToCart}
                  />
                ))}
              </div>
            </main>
          </div>
        );
      case 'cart':
        return (
          <CartScreen 
            cartItems={cartItems} 
            onBack={handleBack}
            onProceedToPayment={handleProceedToPayment}
          />
        );
      case 'payment':
        return (
          <PaymentScreen 
            cartItems={cartItems}
            total={paymentTotal}
            onBack={handleBack}
            onPaymentSuccess={handlePaymentSuccess}
          />
        );
      case 'servicio':
        return <ServiceScreen onBack={handleBack} />;
      case 'ubicacion':
        return <LocationScreen onBack={handleBack} />;
      case 'mision':
        return <MissionScreen onBack={handleBack} />;
      case 'vision':
        return <VisionScreen onBack={handleBack} />;
      case 'creditos':
        return <CreditsScreen onBack={handleBack} />;
      default:
        return <WelcomeScreen onNavigate={setCurrentView} />;
    }
  };

  return renderView();
};

export default App;

// DONE
